/****************************************************************************
**
** Copyright (C) 2016
**
** This file is generated by the Magus toolkit
**
** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
**
****************************************************************************/

#ifndef MAGUS_NODE_COMPOUND_H
#define MAGUS_NODE_COMPOUND_H

#include "node_node.h"
#include "node_porttype.h"

QT_BEGIN_NAMESPACE

QT_END_NAMESPACE

namespace Magus
{
    /****************************************************************************
    QtCompoundNode is a subclass of QtNode that contains other nodes. This is
    usefull to clean-up the editor canvas, but can also be used as a blueprint /
    template.
    ***************************************************************************/
    class QtCompoundNode : public QtNode
    {
        Q_OBJECT

        public:
            QtCompoundNode(QString title, QGraphicsItem* parent = 0);
            virtual ~QtCompoundNode(void);

            // Overridden from parent
            virtual void _prepareDelete(void);

            // Add a node to the compound; it becomes invisible.
            // Nodes that are connected to the added node, remain connected, but via the compound.
            // The connected port is displayed in the compound.
            void addNode(QtNode* node);

            // Remove a node from the compound; it becomes visible again (the node is not deleted).
            // A removed node that still has a connection with a node in the compound remains connected (but with the
            // compound). The port of the connected node is part of and displayed in the compound.
            void removeNode(QtNode* node);

            // Returns true in case the given node is included in this compound.
            bool isNodeOfThisCompound (QtNode* node);

            // Returns the vector with nodes added to this compound.
            // Note, that the connections of the returned nodes are not correct as long as the nodes are part
            // of the compound. The connections are rewired, so the internal relations of the nodes are changed.
            // Only if the compound is removed (deleted), its added nodes are released and their original
            // relationships are restored.
            QVector<QtNode*> getNodes(void);

            // Default behaviour is that the added nodes are released and the compound deleted.
            virtual void mouseLeftClickAction2ButtonHandler(QGraphicsSceneMouseEvent* mouseEvent, QGraphicsItem* item);

        protected:
            bool isCompoundNode(QtNode* node);

        signals:
            // Emitted when the a node is added to the compound.
            void nodeAdded(QtNode*);

            // Emitted when the a node is removed (not deleted) from the compound.
            void nodeRemoved(QtNode*);

        private:
            QVector<QtNode*> mNodeList;
    };
}

#endif
